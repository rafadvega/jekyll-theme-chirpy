<!DOCTYPE html><html lang="es" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio" /><meta name="author" content="Rafa de Vega" /><meta property="og:locale" content="es" /><meta name="description" content="Desplegando el Controlador de Dominio." /><meta property="og:description" content="Desplegando el Controlador de Dominio." /><link rel="canonical" href="https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/" /><meta property="og:url" content="https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/" /><meta property="og:site_name" content="rdevega" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-15T05:33:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Rafa de Vega"},"dateModified":"2021-07-15T05:33:00+02:00","datePublished":"2021-07-15T05:33:00+02:00","description":"Desplegando el Controlador de Dominio.","headline":"Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio","mainEntityOfPage":{"@type":"WebPage","@id":"https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/"},"url":"https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/"}</script><title>Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio | rdevega</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="rdevega"><meta name="application-name" content="rdevega"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/images/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">rdevega</a></div><div class="site-subtitle font-italic">Blog sobre ciberseguridad centrado en Threat Hunting e IR</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rafadvega" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/rdevega" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rafadevega','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rafa de Vega </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 15, 2021, 5:33 AM +0200" >Jul 15, 2021<i class="unloaded">2021-07-15T05:33:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="817 words">4 min leer</span></div></div><div class="post-content"><h1 id="desplegando-el-controlador-de-dominio">Desplegando el Controlador de Dominio.</h1><h2 id="instalación-del-servidor">Instalación del servidor</h2><p>El siguiente paso en nuestro despliegue, será desplegar el controlador de dominio. Para ello, emplearemos una versión de evaluación de un Windows Server 2019, que podemos descargar del <a href="https://www.microsoft.com/es-es/evalcenter/">Evaluation Center</a> de Microsoft. Una máquina virtual con las siguientes características debería ser suficiente:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img1.bmp" alt="img1" width="1086" height="542" /></p><p>Como podemos ver, la conectaremos unicamente a la red que hemos creado anteriormente, por lo que si queremos que la máquina tenga conexión a Internet, deberá estar levantada la máquina del pfsense. Seleccionamos la versión Standard, con interfaz gráfica:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img2.bmp" alt="img" width="1086" height="542" /></p><p>Seleccionamos “custom installation” y el disco completo que hemos asignado a la máquina virtual:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img3.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img4.bmp" alt="img" width="1086" height="542" /></p><p>Configuramos la contraseña del usuario Administrator:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img5.bmp" alt="img" width="1086" height="542" /></p><p>Una vez termine la instalación, es recomendable instalar las VMWare tools (o las correspondientes si es virtual box):</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img6.bmp" alt="img" width="1086" height="542" /></p><p>Si comprobamos nuestra interfaz de red, vemos que ya tiene asignada una ip en el rango que le hemos configurado al pfSense.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img7.bmp" alt="img" width="1086" height="542" /></p><p>Sin embargo, en nuestra red, será el “Domain Controller” el que se encargará de asignar ips, además, debe estar en una ip estática, por lo que se la configuraremos siguiendo los pasos que se muestran en las imágenes:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img8.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img9.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img10.bmp" alt="img" width="1086" height="542" /></p><p>A continuación, en el Server Manager que se abre cuando arrancamos la máquina, cambiaremos el nombre de host en “Local Server”:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img11.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img12.bmp" alt="img" width="1086" height="542" /></p><p>El siguiente paso será promocionar el servidor Windows a controlador de dominio, para lo que abriremos “add Roles and features”:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img13.bmp" alt="img" width="1086" height="542" /></p><h2 id="instalación-de-los-roles-del-servidor">Instalación de los roles del servidor</h2><p>Seguimos las instrucciones paso a paso, y seleccionamos como roles para instalar:</p><ul><li>Active Directory Domain Service<li>DHCP Server<li>DNS Server</ul><p>Y finalmente pulsamos en instalar:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img14.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img15.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img16.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img17.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img18.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img19.bmp" alt="img" width="1086" height="542" /></p><p>Una vez finalizada la instalación, pulsaremos sobre “Promote this server to a domain controller”:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img20.bmp" alt="img" width="1086" height="542" /></p><p>Seleccionamos “Add new Forest” y pondremos el nombre de nuestro dominio:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img21.bmp" alt="img" width="1086" height="542" /></p><p>Elegimos windos Server 2012 R2 en ambos combobox y la password que elijamos:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img22.bmp" alt="img" width="1086" height="542" /></p><p>Y los siguientes paneles los dejaremos por defecto hasta poder darle al botón de instalar:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img23.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img24.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img25.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img26.bmp" alt="img" width="1086" height="542" /></p><p>Una vez instalado, el servidor se reiniciará:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img27.bmp" alt="img" width="1086" height="542" /></p><p>Una vez arrancado de nuevo el servidor, en la parte de notificaciones, tendremos la opción de completar la configuración del servidor de DHCP:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img28.bmp" alt="img" width="1086" height="542" /></p><p>y seguimos los pasos dejando todo por defecto hasta el final:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img29.bmp" alt="img" width="1086" height="542" /></p><p>A continuación clickamos en el siguiente sitio:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img30.bmp" alt="img" width="1086" height="542" /></p><p>Aquí, botón derecho sobre IPv4 y pulsamos “New Scope”</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img31.bmp" alt="img" width="1086" height="542" /></p><p>Configuramos el nombre y el rango de ips que queramos que asigne nuestro DC, por ejemplo, siguiendo el rango de red que estamos usando, se puede seleccionar desde la 10.0.89.50 hasta la 10.0.89.200:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img32.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img33.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img34.bmp" alt="img" width="1086" height="542" /></p><p>Ponemos la ip de nuestro gateway:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img35.bmp" alt="img" width="1086" height="542" /></p><p>Y los DNS que servirá el servidor DHCP. En este caso pondremos la propia ip de nuestro DC, y un servidor secundario, por ejemplo el 1.1.1.1 y finalizamos esta configuración:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img36.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img37.bmp" alt="img" width="1086" height="542" /></p><h2 id="creación-de-los-usuarios-del-dominio">Creación de los usuarios del dominio</h2><p>El siguiente paso será crear el esquema de nuestra organización, para ello pulsaremos sobre “Active Directory Users and Computers”:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img38.bmp" alt="img" width="1086" height="542" /></p><p>Haciendo click derecho en nuestro dominio añadiremos una “organizational unit” que nombraremos con el mismo nombre, y partir de esto, seguiremos creando unidades organizacionales hasta tener una arquitectura a nuestro gusto (la forma en que lo organicemos, será a nuestro gusto, en este caso como los usuarios ficticios serán personajes de mario bros, lo dejo como sigue en la siguientes capturas).</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img39.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img40.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img41.bmp" alt="img" width="1086" height="542" /></p><p>Ahora, dentro de la unidad de usuarios, crearé mis usuarios ficticios siguiendo los pasos que se describen en la imagen:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img42.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img43.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img44.bmp" alt="img" width="1086" height="542" /></p><p>Creamos cuantos usuarios queramos, por ejemplo, para este laboratorio lo dejamos así:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img45.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img46.bmp" alt="img" width="1086" height="542" /></p><p>Ahora crearemos también un grupo de usuarios en la unidad de grupos:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img47.bmp" alt="img" width="1086" height="542" /></p><p>Este grupo lo emplearemos para configurar qué usuario serán administradores locales de los equipos. Así que posteriormente, seleccionaremos los usuarios deseados (en este caso mario y luigi) y les asignaremos ese grupo haciendo click derecho y seleccionando la opción adecuada:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img48.bmp" alt="img" width="1086" height="542" /></p><p>Si revisamos el grupo creado, veremos ya los dos usuarios añadidos. También podremos añadir usuarios desde aquí:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img49.bmp" alt="img" width="1086" height="542" /></p><h2 id="configurando-gpos">Configurando GPOs</h2><p>Para que los usuarios de este grupo sean administradores locales, usaremos una configuración mediante GPO. Para ello en Tools -&gt; “Group Policy Management”:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img50.bmp" alt="img" width="1086" height="542" /></p><p>Buscaremos la GPO en el directorio correspondiente, le daremos al bóton derecho del ratón y seleccioanmos “edit”.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img51.bmp" alt="img" width="1086" height="542" /></p><p>Esto nos abrirá el editor de GPOs, en donde seleccionaremos “Local Users and Groups”, y sobre esto pulsaremos botón derecho y New -&gt; Local Group:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img52.bmp" alt="img" width="1086" height="542" /></p><p>Ahí seleccionaremos “Administrators” y añadiremos al grupo creado:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img53.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img54.bmp" alt="img" width="1086" height="542" /></p><p>Y estos usuarios ya son administradores locales en cualquier equipo que se agregue al dominio. Para</p><p>Como usaremos este laboratorio para hacer pruebas con software muchas veces “no legítimo”, una buena opción puede ser desactivar el antivirus. Una buena opción para esto será crear una GPO, así que, una vez creada otra política de forma idéntica al anterior caso, pero ahora la editaremos como se ve en las imágenes, deshabilitando el antivirus:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img55.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img56.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img57.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img58.bmp" alt="img" width="1086" height="542" /></p><h2 id="creando-el-administrador-de-dominio">Creando el administrador de dominio</h2><p>Una cosa más que podemos hacer, es asignar uno de los usuaros al grupo de administradores de dominio, para no tener que estar utilizando nuestro “Administrator”. Para esto, seleccionamos cualquier usuario y lo editamos:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img59.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img60.bmp" alt="img" width="1086" height="542" /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1086 542'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/domainController/img61.bmp" alt="img" width="1086" height="542" /></p><p>Y nuestro dominio ya está listo!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/threat-hunting/'>Threat Hunting</a>, <a href='/categories/laboratorio/'>Laboratorio</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/threat-hunting/" class="post-tag no-text-decoration" >threat hunting</a> <a href="/tags/hunting/" class="post-tag no-text-decoration" >hunting</a> <a href="/tags/laboratorio/" class="post-tag no-text-decoration" >laboratorio</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/domain-controller/" class="post-tag no-text-decoration" >domain controller</a> <a href="/tags/dc/" class="post-tag no-text-decoration" >dc</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esto es un post bajo licencia <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> .</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://es.linkedin.com/in/rdevega" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio - rdevega&u=https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio - rdevega&url=https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copiado!')" data-toggle="tooltip" data-placement="top" title="Copiar Link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Última actualización</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Creando-un-laboratorio-para-threat-hunting-v/">Creando un laboratorio para threat hunting V. Configurando la auditoría de los sistemas operativos</a><li><a href="/posts/Creando-un-laboratorio-para-threat-hunting-vi/">Creando un laboratorio para threat hunting VI. Desplegando Splunk</a><li><a href="/posts/Creando-un-laboratorio-para-threat-hunting-i/">Creando un laboratorio para threat hunting I. Introducción</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hunting/">hunting</a> <a class="post-tag" href="/tags/laboratorio/">laboratorio</a> <a class="post-tag" href="/tags/threat-hunting/">threat hunting</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/redhat/">redhat</a> <a class="post-tag" href="/tags/auditor%C3%ADa/">auditoría</a> <a class="post-tag" href="/tags/dc/">dc</a> <a class="post-tag" href="/tags/domain-controller/">domain controller</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/pfsense/">pfsense</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contenidos</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Creando-un-laboratorio-para-threat-hunting-iv/"><div class="card-body"> <span class="timeago small" >Jul 22, 2021<i class="unloaded">2021-07-22T05:33:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creando un laboratorio para threat hunting IV. Desplegando Máquinas del dominio</h3><div class="text-muted small"><p> Desplegando Máquinas del dominio Instalación de Windows 10 Antes de ponernos a instalar la máquina, ejecutaremos en el controlador de dominio el siguiente comando: Que hará que cada vez que un...</p></div></div></a></div><div class="card"> <a href="/posts/Creando-un-laboratorio-para-threat-hunting-v/"><div class="card-body"> <span class="timeago small" >Jul 29, 2021<i class="unloaded">2021-07-29T05:33:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creando un laboratorio para threat hunting V. Configurando la auditoría de los sistemas operativos</h3><div class="text-muted small"><p> Configurando la auditoría de los sistemas operativos Auditoría de Windows La auditoría de Windows la configuraremos mediante una GPO, para que aplique tanto al DC como a las máquinas que añadamos...</p></div></div></a></div><div class="card"> <a href="/posts/Creando-un-laboratorio-para-threat-hunting-i/"><div class="card-body"> <span class="timeago small" >Jul 1, 2021<i class="unloaded">2021-07-01T05:33:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creando un laboratorio para threat hunting I. Introducción</h3><div class="text-muted small"><p> En esta serie de posts, nos centraremos en crear un pequeño laboratorio para nuestros ejercicios de threat hunting, existen varias soluciones ya automatizadas. como pueden ser DetectionLab o adaz,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Creando-un-laboratorio-para-threat-hunting-ii/" class="btn btn-outline-primary" prompt="Older"><p>Creando un laboratorio para threat hunting II. Desplegando pfSense</p></a> <a href="/posts/Creando-un-laboratorio-para-threat-hunting-iv/" class="btn btn-outline-primary" prompt="Newer"><p>Creando un laboratorio para threat hunting IV. Desplegando Máquinas del dominio</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//rafadvega.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Creando un laboratorio para threat hunting III. Desplegando Controlador de dominio'; this.page.url = 'https://rafadvega.github.io/posts/Creando-un-laboratorio-para-threat-hunting-iii/'; this.page.identifier = '/posts/Creando-un-laboratorio-para-threat-hunting-iii/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/rdevega">Rafa de Vega</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hunting/">hunting</a> <a class="post-tag" href="/tags/laboratorio/">laboratorio</a> <a class="post-tag" href="/tags/threat-hunting/">threat hunting</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/redhat/">redhat</a> <a class="post-tag" href="/tags/auditor%C3%ADa/">auditoría</a> <a class="post-tag" href="/tags/dc/">dc</a> <a class="post-tag" href="/tags/domain-controller/">domain controller</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/pfsense/">pfsense</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rafadvega.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se han encontrado resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-MWKT6JFF0L"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MWKT6JFF0L'); }); </script>
